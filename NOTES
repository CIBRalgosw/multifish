sudo yum update -y
sudo amazon-linux-extras install -y epel

sudo yum install -y yum-utils pciutils wget fuse s3fs-fuse bzip2
sudo yum  install nfs-utils
sudo yum group install -y "Development Tools"

sudo yum install -y kernel-devel-`uname -r`

wget https://us.download.nvidia.com/XFree86/Linux-x86_64/460.73.01/NVIDIA-Linux-x86_64-460.73.01.run

sudo yum-config-manager --add-repo https://developer.download.nvidia.com/compute/cuda/repos/rhel7/x86_64/cuda-rhel7.repo
sudo yum install -y cuda-toolkit-10-2

#sudo yum clean all
#sudo yum -y install nvidia-driver-latest-dkms cuda
#sudo yum -y install cuda-drivers


# install aws-cli using miniconda
wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh
bash Miniconda3-latest-Linux-x86_64.sh -b -f -p $HOME/miniconda
$HOME/miniconda/bin/conda install -c conda-forge -y awscli
rm Miniconda3-latest-Linux-x86_64.sh

sudo mkdir /efs-multifish
sudo echo -e 'fs-509941e4:/\t/efs-multifish\tefs\trw,_netdev\t0\t0' | sudo tee -a /etc/fstab

sudo mkdir /s3-multifish
sudo echo -e 's3fs#janelia-nextflow-demo:/multifish\t/s3-multifish\tfuse\trw,_netdev,use_path_request_style,allow_other,umask=0000,iam_role=auto,kernel_cache,max_background=1000,max_stat_cache_size=100000,multipart_size=52,parallel_count=30,dbglevel=warn\t0\t0' | sudo tee -a /etc/fstab

sudo mount â€“a


s3fs janelia-nextflow-demo:/multifish /s3/multifish -o nosscache -o iam_role=auto -o umask=0000

sudo systemctl stop ecs
sudo rm -rf /var/lib/ecs/data/ecs_agent_data.json


